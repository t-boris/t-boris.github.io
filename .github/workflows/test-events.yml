name: Test Events Fetcher (Dry Run)

# Manual trigger only - for testing without committing
on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  test-events-fetcher:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Setup Python 3.11
      - name: Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      # 3. Install Python dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r scripts/requirements.txt

      # 4. Run events fetcher script (dry-run mode)
      - name: Run events fetcher (TEST MODE)
        env:
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          GOOGLE_SEARCH_ENGINE_ID: ${{ secrets.GOOGLE_SEARCH_ENGINE_ID }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "========================================="
          echo "TEST MODE: Running events fetcher"
          echo "No changes will be committed"
          echo "========================================="
          python scripts/fetch_events.py

      # 5. Show generated files
      - name: Show generated data
        run: |
          echo "========================================="
          echo "Generated events.json:"
          echo "========================================="
          if [ -f _data/events.json ]; then
            cat _data/events.json | head -50
          else
            echo "No events.json file generated"
          fi

          echo ""
          echo "========================================="
          echo "Generated markdown files:"
          echo "========================================="
          ls -lh _data/events/*.md 2>/dev/null || echo "No markdown files generated"

      # 6. Dry-run complete
      - name: Test complete
        run: |
          echo "========================================="
          echo "âœ… TEST COMPLETE"
          echo "Review the output above to verify"
          echo "No changes were committed to repository"
          echo "========================================="
